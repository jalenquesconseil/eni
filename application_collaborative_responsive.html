<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation Handicap - Mode Collaboratif</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* √âcran de connexion */
        .login-screen {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            margin: 100px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .login-screen h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .role-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .role-btn {
            flex: 1;
            padding: 30px 20px;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }

        .role-btn:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .role-btn.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .role-btn .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .role-btn .title {
            font-weight: bold;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #667eea;
            color: white;
            width: 100%;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        /* Interface principale */
        .main-interface {
            display: none;
        }

        .main-interface.active {
            display: block;
        }

        .session-info {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .session-code {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 3px;
        }

        .participant-count {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .diagram-container {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .diagram-container.active {
            display: block;
        }

        .question-title {
            text-align: center;
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .svg-wrapper {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            cursor: crosshair;
        }

        .svg-wrapper svg {
            display: block;
            width: 100%;
            height: auto;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #2c3e50;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            color: #555;
        }

        .qr-code-container {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .hidden {
            display: none;
        }

        .animator-controls {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .point {
            cursor: pointer;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }

            .tab {
                padding: 10px 20px;
                font-size: 14px;
            }

            .question-title {
                font-size: 1.2em;
            }

            .session-code {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Formation Sensibilisation au Handicap</h1>

        <!-- √âcran de connexion -->
        <div id="loginScreen" class="login-screen">
            <h2>Rejoindre une session</h2>
            
            <div class="role-selection">
                <div class="role-btn" onclick="selectRole('animator')">
                    <div class="icon">üë®‚Äçüè´</div>
                    <div class="title">Animateur</div>
                </div>
                <div class="role-btn selected" onclick="selectRole('participant')">
                    <div class="icon">üë§</div>
                    <div class="title">Participant</div>
                </div>
            </div>

            <div id="animatorForm" class="hidden">
                <div class="input-group">
                    <label>Cr√©er une nouvelle session</label>
                    <input type="text" id="sessionNameInput" placeholder="Nom de la session (optionnel)">
                </div>
                <button class="btn btn-primary" onclick="createSession()">üöÄ Cr√©er la session</button>
            </div>

            <div id="participantForm">
                <div class="input-group">
                    <label>Code de session</label>
                    <input type="text" id="sessionCodeInput" placeholder="Ex: ABC123" style="text-transform: uppercase;">
                </div>
                <div class="input-group">
                    <label>Votre pseudo (optionnel)</label>
                    <input type="text" id="pseudoInput" placeholder="Ex: Jean">
                </div>
                <button class="btn btn-primary" onclick="joinSession()">‚úÖ Rejoindre</button>
            </div>
        </div>

        <!-- Interface principale -->
        <div id="mainInterface" class="main-interface">
            <div class="session-info">
                <div>
                    <strong>Code de session :</strong>
                    <span class="session-code" id="displaySessionCode"></span>
                </div>
                <div class="participant-count">
                    <span>üë•</span>
                    <span id="participantCount">0</span>
                    <span>participant(s)</span>
                </div>
                <button class="btn btn-danger" onclick="leaveSession()">üö™ Quitter</button>
            </div>

            <div id="animatorPanel" class="animator-controls hidden">
                <h3 style="margin-bottom: 15px;">üéõÔ∏è Contr√¥les Animateur</h3>
                <div class="controls">
                    <button class="btn btn-danger" onclick="clearAllPoints()">üóëÔ∏è Effacer tous les points</button>
                    <button class="btn btn-success" onclick="downloadResults()">üíæ T√©l√©charger les r√©sultats</button>
                </div>
                <div id="qrCodeArea" class="qr-code-container">
                    <h4>QR Code pour rejoindre la session</h4>
                    <div id="qrcode"></div>
                    <p style="margin-top: 10px;">Les participants peuvent scanner ce QR code</p>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showDiagram('diagram1')">Difficult√©s au travail</button>
                <button class="tab" onclick="showDiagram('diagram2')">Envie de rester</button>
                <button class="tab" onclick="showDiagram('diagram3')">Stress au travail</button>
            </div>

            <!-- Diagramme 1 -->
            <div id="diagram1" class="diagram-container active">
                <h2 class="question-title">Ce qui est le plus difficile √† g√©rer dans mon quotidien au travail</h2>
                <div class="svg-wrapper" id="svgWrapper1">
                    <svg id="svg1" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <!-- D√©finition des d√©grad√©s -->
                        <defs>
                            <linearGradient id="grad1_1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#E8F4F8;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#D4E9F2;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad1_2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFF4E6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FFE8CC;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad1_3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F0F9FF;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#E0F2FE;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad1_4" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Quadrants color√©s -->
                        <rect x="150" y="150" width="350" height="350" fill="url(#grad1_1)" opacity="0.3"/>
                        <rect x="500" y="150" width="350" height="350" fill="url(#grad1_2)" opacity="0.3"/>
                        <rect x="150" y="500" width="350" height="350" fill="url(#grad1_3)" opacity="0.3"/>
                        <rect x="500" y="500" width="350" height="350" fill="url(#grad1_4)" opacity="0.3"/>
                        
                        <!-- Grille -->
                        <line x1="325" y1="150" x2="325" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="675" y1="150" x2="675" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="325" x2="850" y2="325" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="675" x2="850" y2="675" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        
                        <!-- Axes -->
                        <line x1="150" y1="500" x2="850" y2="500" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="850,500 835,495 835,505" fill="#2c3e50"/>
                        <line x1="500" y1="850" x2="500" y2="150" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="500,150 495,165 505,165" fill="#2c3e50"/>
                        
                        <!-- Labels -->
                        <text x="500" y="70" font-size="16" font-weight="bold" fill="#e74c3c" text-anchor="middle">DIFFICULT√âS INTERNES</text>
                        <text x="500" y="95" font-size="13" fill="#555" text-anchor="middle">(motivation, √©motions, confiance, √©nergie personnelle)</text>
                        
                        <text x="500" y="930" font-size="16" font-weight="bold" fill="#3498db" text-anchor="middle">DIFFICULT√âS EXTERNES</text>
                        <text x="500" y="952" font-size="13" fill="#555" text-anchor="middle">(environnement, mat√©riel, contraintes impos√©es)</text>
                        
                        <g transform="translate(70, 500) rotate(-90)">
                            <text x="0" y="0" font-size="16" font-weight="bold" fill="#9b59b6" text-anchor="middle">DIFFICULT√âS RELATIONNELLES</text>
                            <text x="0" y="20" font-size="13" fill="#555" text-anchor="middle">(interactions, communication, relations d'√©quipe)</text>
                        </g>
                        
                        <g transform="translate(930, 500) rotate(90)">
                            <text x="0" y="0" font-size="16" font-weight="bold" fill="#f39c12" text-anchor="middle">DIFFICULT√âS ORGANISATIONNELLES</text>
                            <text x="0" y="20" font-size="13" fill="#555" text-anchor="middle">(gestion du temps, charge de travail, processus)</text>
                        </g>
                        
                        <text x="180" y="520" font-size="14" fill="#9b59b6" font-weight="bold">‚Üê Relationnelles</text>
                        <text x="720" y="520" font-size="14" fill="#f39c12" text-anchor="end" font-weight="bold">Organisationnelles ‚Üí</text>
                        <text x="510" y="220" font-size="14" fill="#e74c3c" font-weight="bold">‚Üë Internes</text>
                        <text x="510" y="820" font-size="14" fill="#3498db" font-weight="bold">‚Üì Externes</text>
                        
                        <circle cx="500" cy="500" r="6" fill="#2c3e50" opacity="0.5"/>
                        
                        <!-- Groupe pour les points des participants -->
                        <g id="pointsGroup1"></g>
                    </svg>
                </div>
                <div class="controls">
                    <button class="btn btn-danger" onclick="clearMyPoint('diagram1')">üóëÔ∏è Effacer mon point</button>
                </div>
                <div class="color-picker">
                    <span style="font-weight: bold;">Couleur de votre point :</span>
                    <div class="color-option selected" style="background: #e74c3c;" onclick="selectColor('diagram1', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db;" onclick="selectColor('diagram1', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71;" onclick="selectColor('diagram1', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f39c12;" onclick="selectColor('diagram1', '#f39c12')"></div>
                    <div class="color-option" style="background: #9b59b6;" onclick="selectColor('diagram1', '#9b59b6')"></div>
                    <div class="color-option" style="background: #1abc9c;" onclick="selectColor('diagram1', '#1abc9c')"></div>
                </div>
                <div class="instructions">
                    üí° <strong>Instructions :</strong> Cliquez sur le diagramme pour placer votre point. Vous ne pouvez placer qu'un seul point (cliquer √† nouveau d√©place votre point). Tous les participants voient les points en temps r√©el !
                </div>
            </div>

            <!-- Diagramme 2 -->
            <div id="diagram2" class="diagram-container">
                <h2 class="question-title">Ce qui me donne envie de rester dans une entreprise</h2>
                <div class="svg-wrapper" id="svgWrapper2">
                    <svg id="svg2" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad2_1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFF7ED;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FFEDD5;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad2_2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F0FDF4;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#DCFCE7;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad2_3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FEF2F2;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FEE2E2;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad2_4" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#EFF6FF;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#DBEAFE;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <rect x="150" y="150" width="350" height="350" fill="url(#grad2_1)" opacity="0.4"/>
                        <rect x="500" y="150" width="350" height="350" fill="url(#grad2_2)" opacity="0.4"/>
                        <rect x="150" y="500" width="350" height="350" fill="url(#grad2_3)" opacity="0.4"/>
                        <rect x="500" y="500" width="350" height="350" fill="url(#grad2_4)" opacity="0.4"/>
                        
                        <line x1="325" y1="150" x2="325" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="675" y1="150" x2="675" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="325" x2="850" y2="325" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="675" x2="850" y2="675" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        
                        <line x1="150" y1="500" x2="850" y2="500" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="850,500 835,495 835,505" fill="#2c3e50"/>
                        <line x1="500" y1="850" x2="500" y2="150" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="500,150 495,165 505,165" fill="#2c3e50"/>
                        
                        <text x="500" y="70" font-size="16" font-weight="bold" fill="#f39c12" text-anchor="middle">BESOIN DE RECONNAISSANCE</text>
                        <text x="500" y="95" font-size="13" fill="#555" text-anchor="middle">(valorisation, consid√©ration, √©coute)</text>
                        
                        <text x="500" y="930" font-size="16" font-weight="bold" fill="#e74c3c" text-anchor="middle">BESOIN DE S√âCURIT√â</text>
                        <text x="500" y="952" font-size="13" fill="#555" text-anchor="middle">(stabilit√© financi√®re, cadre clair, protection)</text>
                        
                        <g transform="translate(70, 500) rotate(-90)">
                            <text x="0" y="0" font-size="16" font-weight="bold" fill="#e67e22" text-anchor="middle">BESOIN D'APPARTENANCE</text>
                            <text x="0" y="20" font-size="13" fill="#555" text-anchor="middle">(faire partie d'un collectif, lien social)</text>
                        </g>
                        
                        <g transform="translate(930, 500) rotate(90)">
                            <text x="0" y="0" font-size="16" font-weight="bold" fill="#27ae60" text-anchor="middle">BESOIN D'AUTONOMIE</text>
                            <text x="0" y="20" font-size="13" fill="#555" text-anchor="middle">(libert√©, ind√©pendance, flexibilit√©)</text>
                        </g>
                        
                        <text x="180" y="520" font-size="14" fill="#e67e22" font-weight="bold">‚Üê Appartenance</text>
                        <text x="730" y="520" font-size="14" fill="#27ae60" text-anchor="end" font-weight="bold">Autonomie ‚Üí</text>
                        <text x="510" y="220" font-size="14" fill="#f39c12" font-weight="bold">‚Üë Reconnaissance</text>
                        <text x="510" y="820" font-size="14" fill="#e74c3c" font-weight="bold">‚Üì S√©curit√©</text>
                        
                        <circle cx="500" cy="500" r="6" fill="#2c3e50" opacity="0.5"/>
                        
                        <g id="pointsGroup2"></g>
                    </svg>
                </div>
                <div class="controls">
                    <button class="btn btn-danger" onclick="clearMyPoint('diagram2')">üóëÔ∏è Effacer mon point</button>
                </div>
                <div class="color-picker">
                    <span style="font-weight: bold;">Couleur de votre point :</span>
                    <div class="color-option selected" style="background: #e74c3c;" onclick="selectColor('diagram2', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db;" onclick="selectColor('diagram2', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71;" onclick="selectColor('diagram2', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f39c12;" onclick="selectColor('diagram2', '#f39c12')"></div>
                    <div class="color-option" style="background: #9b59b6;" onclick="selectColor('diagram2', '#9b59b6')"></div>
                    <div class="color-option" style="background: #1abc9c;" onclick="selectColor('diagram2', '#1abc9c')"></div>
                </div>
                <div class="instructions">
                    üí° <strong>Instructions :</strong> Cliquez sur le diagramme pour placer votre point. Vous ne pouvez placer qu'un seul point (cliquer √† nouveau d√©place votre point). Tous les participants voient les points en temps r√©el !
                </div>
            </div>

            <!-- Diagramme 3 -->
            <div id="diagram3" class="diagram-container">
                <h2 class="question-title">Ce qui me stresse au travail</h2>
                <div class="svg-wrapper" id="svgWrapper3">
                    <svg id="svg3" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad3_1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad3_2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#D1FAE5;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#A7F3D0;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad3_3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FECACA;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FCA5A5;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad3_4" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#BFDBFE;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#93C5FD;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <rect x="150" y="150" width="350" height="350" fill="url(#grad3_1)" opacity="0.4"/>
                        <rect x="500" y="150" width="350" height="350" fill="url(#grad3_2)" opacity="0.4"/>
                        <rect x="150" y="500" width="350" height="350" fill="url(#grad3_3)" opacity="0.4"/>
                        <rect x="500" y="500" width="350" height="350" fill="url(#grad3_4)" opacity="0.4"/>
                        
                        <line x1="325" y1="150" x2="325" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="675" y1="150" x2="675" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="325" x2="850" y2="325" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="675" x2="850" y2="675" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        
                        <line x1="150" y1="500" x2="850" y2="500" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="850,500 835,495 835,505" fill="#2c3e50"/>
                        <line x1="500" y1="850" x2="500" y2="150" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="500,150 495,165 505,165" fill="#2c3e50"/>
                        
                        <text x="500" y="70" font-size="16" font-weight="bold" fill="#16a34a" text-anchor="middle">STRESS EXPRIMABLE</text>
                        <text x="500" y="95" font-size="13" fill="#555" text-anchor="middle">(je peux en parler, c'est l√©gitime)</text>
                        
                        <text x="500" y="930" font-size="16" font-weight="bold" fill="#dc2626" text-anchor="middle">STRESS INDICIBLE</text>
                        <text x="500" y="952" font-size="13" fill="#555" text-anchor="middle">(tabou, honte, incompris)</text>
                        
                        <g transform="translate(70, 500) rotate(-90)">
                            <text x="0" y="0" font-size="16" font-weight="bold" fill="#ea580c" text-anchor="middle">PEU DE CONTR√îLE</text>
                            <text x="0" y="20" font-size="13" fill="#555" text-anchor="middle">(je subis, impuissance)</text>
                        </g>
                        
                        <g transform="translate(930, 500) rotate(90)">
                            <text x="0" y="0" font-size="16" font-weight="bold" fill="#0284c7" text-anchor="middle">BEAUCOUP DE CONTR√îLE</text>
                            <text x="0" y="20" font-size="13" fill="#555" text-anchor="middle">(je peux agir, solutions possibles)</text>
                        </g>
                        
                        <text x="180" y="520" font-size="14" fill="#ea580c" font-weight="bold">‚Üê Peu de contr√¥le</text>
                        <text x="730" y="520" font-size="14" fill="#0284c7" text-anchor="end" font-weight="bold">Beaucoup de contr√¥le ‚Üí</text>
                        <text x="510" y="220" font-size="14" fill="#16a34a" font-weight="bold">‚Üë Exprimable</text>
                        <text x="510" y="820" font-size="14" fill="#dc2626" font-weight="bold">‚Üì Indicible</text>
                        
                        <circle cx="500" cy="500" r="6" fill="#2c3e50" opacity="0.5"/>
                        
                        <g id="pointsGroup3"></g>
                    </svg>
                </div>
                <div class="controls">
                    <button class="btn btn-danger" onclick="clearMyPoint('diagram3')">üóëÔ∏è Effacer mon point</button>
                </div>
                <div class="color-picker">
                    <span style="font-weight: bold;">Couleur de votre point :</span>
                    <div class="color-option selected" style="background: #e74c3c;" onclick="selectColor('diagram3', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db;" onclick="selectColor('diagram3', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71;" onclick="selectColor('diagram3', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f39c12;" onclick="selectColor('diagram3', '#f39c12')"></div>
                    <div class="color-option" style="background: #9b59b6;" onclick="selectColor('diagram3', '#9b59b6')"></div>
                    <div class="color-option" style="background: #1abc9c;" onclick="selectColor('diagram3', '#1abc9c')"></div>
                </div>
                <div class="instructions">
                    üí° <strong>Instructions :</strong> Cliquez sur le diagramme pour placer votre point. Vous ne pouvez placer qu'un seul point (cliquer √† nouveau d√©place votre point). Tous les participants voient les points en temps r√©el !
                </div>
            </div>
        </div>
    </div>

    <!-- QRCode.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // Configuration globale
        let currentSession = null;
        let currentUser = null;
        let isAnimator = false;
        let sessionData = {};

        // Configuration pour chaque diagramme
        const diagramConfig = {
            diagram1: { color: '#e74c3c' },
            diagram2: { color: '#e74c3c' },
            diagram3: { color: '#e74c3c' }
        };

        // Initialiser les gestionnaires de clic pour chaque SVG
        ['diagram1', 'diagram2', 'diagram3'].forEach(diagramId => {
            const svgWrapper = document.getElementById('svgWrapper' + diagramId.slice(-1));
            const svg = document.getElementById('svg' + diagramId.slice(-1));
            
            svgWrapper.addEventListener('click', function(e) {
                if (!currentSession) return;
                
                const rect = svg.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 1000;
                const y = ((e.clientY - rect.top) / rect.height) * 1000;
                
                addPoint(diagramId, x, y);
            });
        });

        function selectRole(role) {
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.role-btn').classList.add('selected');
            
            if (role === 'animator') {
                document.getElementById('animatorForm').classList.remove('hidden');
                document.getElementById('participantForm').classList.add('hidden');
            } else {
                document.getElementById('animatorForm').classList.add('hidden');
                document.getElementById('participantForm').classList.remove('hidden');
            }
        }

        function generateSessionCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function createSession() {
            const sessionCode = generateSessionCode();
            const sessionName = document.getElementById('sessionNameInput').value || 'Session sans nom';
            
            currentSession = sessionCode;
            currentUser = 'animator_' + Date.now();
            isAnimator = true;
            
            sessionData = {
                code: sessionCode,
                name: sessionName,
                created: Date.now(),
                participants: {},
                points: {
                    diagram1: [],
                    diagram2: [],
                    diagram3: []
                }
            };
            
            saveSessionData();
            showMainInterface();
            generateQRCode();
        }

        function joinSession() {
            const code = document.getElementById('sessionCodeInput').value.toUpperCase().trim();
            const pseudo = document.getElementById('pseudoInput').value || 'Participant';
            
            if (!code) {
                alert('‚ö†Ô∏è Veuillez entrer un code de session');
                return;
            }
            
            const storedSession = localStorage.getItem('session_' + code);
            if (!storedSession) {
                alert('‚ùå Session introuvable. V√©rifiez le code.');
                return;
            }
            
            currentSession = code;
            currentUser = 'user_' + Date.now();
            isAnimator = false;
            
            sessionData = JSON.parse(storedSession);
            sessionData.participants[currentUser] = {
                pseudo: pseudo,
                joined: Date.now()
            };
            
            saveSessionData();
            showMainInterface();
            startAutoRefresh();
        }

        function showMainInterface() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainInterface').classList.add('active');
            document.getElementById('displaySessionCode').textContent = currentSession;
            
            if (isAnimator) {
                document.getElementById('animatorPanel').classList.remove('hidden');
            }
            
            updateParticipantCount();
            redrawAllDiagrams();
        }

        function leaveSession() {
            if (confirm('Voulez-vous vraiment quitter la session ?')) {
                if (isAnimator && confirm('‚ö†Ô∏è En tant qu\'animateur, quitter supprimera la session pour tous. Continuer ?')) {
                    localStorage.removeItem('session_' + currentSession);
                } else if (!isAnimator) {
                    delete sessionData.participants[currentUser];
                    saveSessionData();
                }
                location.reload();
            }
        }

        function addPoint(diagramId, x, y) {
            // Supprimer le point existant de l'utilisateur
            sessionData.points[diagramId] = sessionData.points[diagramId].filter(
                point => point.userId !== currentUser
            );
            
            // Ajouter le nouveau point
            const point = {
                x: x,
                y: y,
                color: diagramConfig[diagramId].color,
                userId: currentUser,
                timestamp: Date.now()
            };
            
            sessionData.points[diagramId].push(point);
            saveSessionData();
            redrawDiagram(diagramId);
        }

        function clearMyPoint(diagramId) {
            sessionData.points[diagramId] = sessionData.points[diagramId].filter(
                point => point.userId !== currentUser
            );
            saveSessionData();
            redrawDiagram(diagramId);
        }

        function clearAllPoints() {
            if (!isAnimator) return;
            
            if (confirm('Effacer tous les points de tous les participants ?')) {
                sessionData.points = {
                    diagram1: [],
                    diagram2: [],
                    diagram3: []
                };
                saveSessionData();
                redrawAllDiagrams();
            }
        }

        function redrawDiagram(diagramId) {
            const diagramNumber = diagramId.slice(-1);
            const pointsGroup = document.getElementById('pointsGroup' + diagramNumber);
            
            // Effacer les points existants
            pointsGroup.innerHTML = '';
            
            // Dessiner tous les points
            if (sessionData.points && sessionData.points[diagramId]) {
                sessionData.points[diagramId].forEach((point, index) => {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', point.x);
                    circle.setAttribute('cy', point.y);
                    circle.setAttribute('r', '10');
                    circle.setAttribute('fill', point.color);
                    circle.setAttribute('stroke', '#fff');
                    circle.setAttribute('stroke-width', '2');
                    circle.setAttribute('class', 'point');
                    circle.setAttribute('data-user', point.userId);
                    pointsGroup.appendChild(circle);
                });
            }
        }

        function redrawAllDiagrams() {
            ['diagram1', 'diagram2', 'diagram3'].forEach(diagramId => {
                redrawDiagram(diagramId);
            });
        }

        function selectColor(diagramId, color) {
            diagramConfig[diagramId].color = color;
            
            const container = document.getElementById(diagramId);
            container.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function showDiagram(diagramId) {
            document.querySelectorAll('.diagram-container').forEach(container => {
                container.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(diagramId).classList.add('active');
            event.target.classList.add('active');
        }

        function saveSessionData() {
            localStorage.setItem('session_' + currentSession, JSON.stringify(sessionData));
        }

        function loadSessionData() {
            const stored = localStorage.getItem('session_' + currentSession);
            if (stored) {
                sessionData = JSON.parse(stored);
                redrawAllDiagrams();
                updateParticipantCount();
            }
        }

        function updateParticipantCount() {
            const count = Object.keys(sessionData.participants || {}).length;
            document.getElementById('participantCount').textContent = count;
        }

        function startAutoRefresh() {
            setInterval(() => {
                loadSessionData();
            }, 2000);
        }

        function generateQRCode() {
            const url = window.location.href.split('?')[0] + '?session=' + currentSession;
            
            const qrcodeContainer = document.getElementById('qrcode');
            qrcodeContainer.innerHTML = '';
            
            new QRCode(qrcodeContainer, {
                text: url,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        function downloadResults() {
            if (!isAnimator) return;
            
            let results = `R√©sultats de la session: ${sessionData.name}\n`;
            results += `Code: ${currentSession}\n`;
            results += `Date: ${new Date(sessionData.created).toLocaleString('fr-FR')}\n`;
            results += `Participants: ${Object.keys(sessionData.participants).length}\n\n`;
            
            const questions = [
                'Difficult√©s au travail',
                'Envie de rester dans l\'entreprise',
                'Stress au travail'
            ];
            
            ['diagram1', 'diagram2', 'diagram3'].forEach((diagramId, index) => {
                results += `\n=== ${questions[index]} ===\n`;
                results += `Nombre de points: ${sessionData.points[diagramId].length}\n`;
                
                sessionData.points[diagramId].forEach((point, i) => {
                    const participant = sessionData.participants[point.userId];
                    const pseudo = participant ? participant.pseudo : 'Anonyme';
                    results += `Point ${i+1}: ${pseudo} - Position (${Math.round(point.x)}, ${Math.round(point.y)}) - Couleur: ${point.color}\n`;
                });
            });
            
            const blob = new Blob([results], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `resultats_session_${currentSession}.txt`;
            a.click();
        }

        // D√©tecter si on arrive via QR code
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('session');
            
            if (sessionParam) {
                document.getElementById('sessionCodeInput').value = sessionParam;
            }
        });
    </script>
</body>
</html>
