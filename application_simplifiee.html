<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation Handicap - Version Simplifi√©e</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* √âcran de connexion */
        .login-screen {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            margin: 100px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .login-screen h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .role-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .role-btn {
            flex: 1;
            padding: 30px 20px;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }

        .role-btn:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .role-btn.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .role-btn .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .role-btn .title {
            font-weight: bold;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #667eea;
            color: white;
            width: 100%;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .hidden {
            display: none;
        }

        /* Interface principale simplifi√©e */
        .main-interface {
            display: none;
        }

        .main-interface.active {
            display: block;
        }

        /* Panneau animateur */
        .animator-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .animator-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .session-info-compact {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .session-code-small {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
        }

        .page-navigation {
            display: flex;
            gap: 10px;
        }

        .qr-section {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
        }

        /* Vue participant - Interface √©pur√©e */
        .diagram-view {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .diagram-view.active {
            display: block;
        }

        .svg-wrapper {
            position: relative;
            margin: 0 auto;
            max-width: 1200px;
            cursor: crosshair;
        }

        svg {
            width: 100%;
            height: auto;
            display: block;
        }

        .point {
            transition: all 0.2s;
        }

        .point:hover {
            filter: brightness(1.2);
        }

        /* Labels des axes - TOUS HORIZONTAUX */
        .axis-label {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .axis-sublabel {
            font-size: 14px;
            fill: #666;
            text-align: center;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #2c3e50;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .controls-bottom {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .animator-controls {
                flex-direction: column;
            }

            .session-info-compact {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- √âcran de connexion -->
        <div id="loginScreen" class="login-screen">
            <h2>Rejoindre une session</h2>
            
            <div class="role-selection">
                <div class="role-btn" onclick="selectRole('animator')">
                    <div class="icon">üë®‚Äçüè´</div>
                    <div class="title">Animateur</div>
                </div>
                <div class="role-btn selected" onclick="selectRole('participant')">
                    <div class="icon">üë§</div>
                    <div class="title">Participant</div>
                </div>
            </div>

            <div id="animatorForm" class="hidden">
                <div class="input-group">
                    <label>Cr√©er une nouvelle session</label>
                    <input type="text" id="sessionNameInput" placeholder="Nom de la session (optionnel)">
                </div>
                <button class="btn btn-primary" onclick="createSession()">üöÄ Cr√©er la session</button>
            </div>

            <div id="participantForm">
                <div class="input-group">
                    <label>Code de session</label>
                    <input type="text" id="sessionCodeInput" placeholder="Ex: ABC123" style="text-transform: uppercase;">
                </div>
                <div class="input-group">
                    <label>Votre pseudo (optionnel)</label>
                    <input type="text" id="pseudoInput" placeholder="Ex: Jean">
                </div>
                <button class="btn btn-primary" onclick="joinSession()">‚úÖ Rejoindre</button>
            </div>
        </div>

        <!-- Interface principale -->
        <div id="mainInterface" class="main-interface">
            
            <!-- Panneau animateur (visible uniquement pour l'animateur) -->
            <div id="animatorPanel" class="animator-panel hidden">
                <div class="animator-controls">
                    <div class="session-info-compact">
                        <div>
                            <strong>Session:</strong>
                            <span class="session-code-small" id="displaySessionCode"></span>
                        </div>
                        <div>
                            <strong>üë• Participants:</strong>
                            <span id="participantCount">0</span>
                        </div>
                    </div>

                    <div class="page-navigation">
                        <button class="btn btn-primary" onclick="changePage(1)">Question 1</button>
                        <button class="btn btn-primary" onclick="changePage(2)">Question 2</button>
                        <button class="btn btn-primary" onclick="changePage(3)">Question 3</button>
                    </div>

                    <div>
                        <button class="btn btn-danger" onclick="clearAllPoints()">üóëÔ∏è Effacer tout</button>
                        <button class="btn btn-success" onclick="downloadResults()">üíæ T√©l√©charger</button>
                        <button class="btn btn-secondary" onclick="leaveSession()">üö™ Quitter</button>
                    </div>
                </div>

                <div id="qrCodeArea" class="qr-section">
                    <strong>QR Code pour rejoindre la session</strong>
                    <div id="qrcode" style="margin-top: 10px; display: inline-block;"></div>
                </div>
            </div>

            <!-- Diagramme 1 -->
            <div id="diagram1" class="diagram-view active">
                <div class="svg-wrapper" id="svgWrapper1">
                    <svg id="svg1" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad1-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#E8F4F8;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#D4E9F2;stop-opacity:0.3" />
                            </linearGradient>
                            <linearGradient id="grad1-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFF4E6;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#FFE8CC;stop-opacity:0.3" />
                            </linearGradient>
                            <linearGradient id="grad1-3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F0F9FF;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#E0F2FE;stop-opacity:0.3" />
                            </linearGradient>
                            <linearGradient id="grad1-4" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:0.3" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Quadrants -->
                        <rect x="150" y="150" width="350" height="350" fill="url(#grad1-1)"/>
                        <rect x="500" y="150" width="350" height="350" fill="url(#grad1-2)"/>
                        <rect x="150" y="500" width="350" height="350" fill="url(#grad1-3)"/>
                        <rect x="500" y="500" width="350" height="350" fill="url(#grad1-4)"/>
                        
                        <!-- Grille -->
                        <line x1="325" y1="150" x2="325" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="675" y1="150" x2="675" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="325" x2="850" y2="325" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="675" x2="850" y2="675" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        
                        <!-- Axes -->
                        <line x1="150" y1="500" x2="850" y2="500" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="850,500 835,495 835,505" fill="#2c3e50"/>
                        <line x1="500" y1="850" x2="500" y2="150" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="500,150 495,165 505,165" fill="#2c3e50"/>
                        
                        <!-- Labels des axes - TOUS HORIZONTAUX -->
                        
                        <!-- Haut -->
                        <text x="500" y="100" class="axis-label" fill="#e74c3c" text-anchor="middle" font-size="13">DIFFICULT√âS INTERNES</text>
                        <text x="500" y="120" class="axis-sublabel" text-anchor="middle" font-size="13">(motivation, √©motions,</text>
                        <text x="500" y="135" class="axis-sublabel" text-anchor="middle" font-size="13">confiance, √©nergie)</text>
                        
                        <!-- Bas -->
                        <text x="500" y="910" class="axis-label" fill="#3498db" text-anchor="middle" font-size="13">DIFFICULT√âS EXTERNES</text>
                        <text x="500" y="930" class="axis-sublabel" text-anchor="middle" font-size="13">(environnement, mat√©riel,</text>
                        <text x="500" y="945" class="axis-sublabel" text-anchor="middle" font-size="13">contraintes impos√©es)</text>
                        
                        <!-- Gauche -->
                        <text x="90" y="485" class="axis-label" fill="#9b59b6" text-anchor="middle" font-size="13">RELATIONNELLES</text>
                        <text x="70" y="505" class="axis-sublabel" text-anchor="middle" font-size="13">(interactions)</text>
                        <text x="70" y="525" class="axis-sublabel" text-anchor="middle" font-size="13">(communication)</text>
                        
                        <!-- Droite -->
                        <text x="900" y="475" class="axis-label" fill="#f39c12" text-anchor="middle" font-size="13">ORGANISATIONNELLES</text>
                        <text x="920" y="495" class="axis-sublabel" text-anchor="middle" font-size="13">(temps, charge,</text>
                        <text x="920" y="510" class="axis-sublabel" text-anchor="middle" font-size="13">processus)</text>
                        
                        <!-- Groupe pour les points -->
                        <g id="pointsGroup1"></g>
                    </svg>
                </div>

                <div class="color-picker">
                    <span style="font-weight: bold;">Couleur de votre point :</span>
                    <div class="color-option selected" style="background: #e74c3c;" onclick="selectColor('canvas1', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db;" onclick="selectColor('canvas1', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71;" onclick="selectColor('canvas1', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f39c12;" onclick="selectColor('canvas1', '#f39c12')"></div>
                    <div class="color-option" style="background: #9b59b6;" onclick="selectColor('canvas1', '#9b59b6')"></div>
                    <div class="color-option" style="background: #1abc9c;" onclick="selectColor('canvas1', '#1abc9c')"></div>
                </div>

                <div class="controls-bottom">
                    <button class="btn btn-danger" onclick="clearMyPoint('canvas1')">üóëÔ∏è Effacer mon point</button>
                </div>
            </div>

            <!-- Diagramme 2 -->
            <div id="diagram2" class="diagram-view">
                <div class="svg-wrapper" id="svgWrapper2">
                    <svg id="svg2" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad2-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFF7ED;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#FFEDD5;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad2-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F0FDF4;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#DCFCE7;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad2-3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FEF2F2;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#FEE2E2;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad2-4" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#EFF6FF;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#DBEAFE;stop-opacity:0.4" />
                            </linearGradient>
                        </defs>
                        
                        <rect x="150" y="150" width="350" height="350" fill="url(#grad2-1)"/>
                        <rect x="500" y="150" width="350" height="350" fill="url(#grad2-2)"/>
                        <rect x="150" y="500" width="350" height="350" fill="url(#grad2-3)"/>
                        <rect x="500" y="500" width="350" height="350" fill="url(#grad2-4)"/>
                        
                        <line x1="325" y1="150" x2="325" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="675" y1="150" x2="675" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="325" x2="850" y2="325" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="675" x2="850" y2="675" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        
                        <line x1="150" y1="500" x2="850" y2="500" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="850,500 835,495 835,505" fill="#2c3e50"/>
                        <line x1="500" y1="850" x2="500" y2="150" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="500,150 495,165 505,165" fill="#2c3e50"/>
                        
                        <!-- Haut -->
                        <text x="500" y="100" class="axis-label" fill="#f39c12" text-anchor="middle" font-size="18">BESOIN DE RECONNAISSANCE</text>
                        <text x="500" y="120" class="axis-sublabel" text-anchor="middle" font-size="13">(valorisation,</text>
                        <text x="500" y="135" class="axis-sublabel" text-anchor="middle" font-size="13">consid√©ration, √©coute)</text>
                        
                        <!-- Bas -->
                        <text x="500" y="910" class="axis-label" fill="#e74c3c" text-anchor="middle" font-size="18">BESOIN DE S√âCURIT√â</text>
                        <text x="500" y="930" class="axis-sublabel" text-anchor="middle" font-size="13">(stabilit√© financi√®re,</text>
                        <text x="500" y="945" class="axis-sublabel" text-anchor="middle" font-size="13">cadre clair, protection)</text>
                        
                        <!-- Gauche -->
                        <text x="80" y="490" class="axis-label" fill="#e67e22" text-anchor="middle" font-size="18">APPARTENANCE</text>
                        <text x="80" y="510" class="axis-sublabel" text-anchor="middle" font-size="13">(collectif, lien social)</text>
                        
                        <!-- Droite -->
                        <text x="920" y="490" class="axis-label" fill="#27ae60" text-anchor="middle" font-size="18">AUTONOMIE</text>
                        <text x="920" y="510" class="axis-sublabel" text-anchor="middle" font-size="13">(libert√©, ind√©pendance)</text>
                        
                        <g id="pointsGroup2"></g>
                    </svg>
                </div>

                <div class="color-picker">
                    <span style="font-weight: bold;">Couleur de votre point :</span>
                    <div class="color-option selected" style="background: #e74c3c;" onclick="selectColor('canvas2', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db;" onclick="selectColor('canvas2', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71;" onclick="selectColor('canvas2', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f39c12;" onclick="selectColor('canvas2', '#f39c12')"></div>
                    <div class="color-option" style="background: #9b59b6;" onclick="selectColor('canvas2', '#9b59b6')"></div>
                    <div class="color-option" style="background: #1abc9c;" onclick="selectColor('canvas2', '#1abc9c')"></div>
                </div>

                <div class="controls-bottom">
                    <button class="btn btn-danger" onclick="clearMyPoint('canvas2')">üóëÔ∏è Effacer mon point</button>
                </div>
            </div>

            <!-- Diagramme 3 -->
            <div id="diagram3" class="diagram-view">
                <div class="svg-wrapper" id="svgWrapper3">
                    <svg id="svg3" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad3-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FEF3C7;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#FDE68A;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad3-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#D1FAE5;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#A7F3D0;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad3-3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FECACA;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#FCA5A5;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad3-4" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#BFDBFE;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#93C5FD;stop-opacity:0.4" />
                            </linearGradient>
                        </defs>
                        
                        <rect x="150" y="150" width="350" height="350" fill="url(#grad3-1)"/>
                        <rect x="500" y="150" width="350" height="350" fill="url(#grad3-2)"/>
                        <rect x="150" y="500" width="350" height="350" fill="url(#grad3-3)"/>
                        <rect x="500" y="500" width="350" height="350" fill="url(#grad3-4)"/>
                        
                        <line x1="325" y1="150" x2="325" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="675" y1="150" x2="675" y2="850" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="325" x2="850" y2="325" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="150" y1="675" x2="850" y2="675" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
                        
                        <line x1="150" y1="500" x2="850" y2="500" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="850,500 835,495 835,505" fill="#2c3e50"/>
                        <line x1="500" y1="850" x2="500" y2="150" stroke="#2c3e50" stroke-width="3"/>
                        <polygon points="500,150 495,165 505,165" fill="#2c3e50"/>
                        
                        <!-- Haut -->
                        <text x="500" y="100" class="axis-label" fill="#16a34a" text-anchor="middle" font-size="18">STRESS EXPRIMABLE</text>
                        <text x="500" y="120" class="axis-sublabel" text-anchor="middle" font-size="13">(je peux en parler,</text>
                        <text x="500" y="135" class="axis-sublabel" text-anchor="middle" font-size="13">c'est l√©gitime)</text>
                        
                        <!-- Bas -->
                        <text x="500" y="910" class="axis-label" fill="#dc2626" text-anchor="middle" font-size="18">STRESS INDICIBLE</text>
                        <text x="500" y="930" class="axis-sublabel" text-anchor="middle" font-size="13">(tabou, honte,</text>
                        <text x="500" y="945" class="axis-sublabel" text-anchor="middle" font-size="13">incompris)</text>
                        
                        <!-- Gauche -->
                        <text x="80" y="485" class="axis-label" fill="#ea580c" text-anchor="middle" font-size="17">PEU DE CONTROLE</text>
                        <text x="80" y="505" class="axis-sublabel" text-anchor="middle" font-size="13">(je subis)</text>
                        
                        <!-- Droite -->
                        <text x="920" y="480" class="axis-label" fill="#0284c7" text-anchor="middle" font-size="16">BEAUCOUP DE <br> CONTROLE<br></text>
                        <text x="920" y="500" class="axis-sublabel" text-anchor="middle" font-size="13">(je peux agir,</text>
                        <text x="920" y="515" class="axis-sublabel" text-anchor="middle" font-size="13">solutions)</text>
                        
                        <g id="pointsGroup3"></g>
                    </svg>
                </div>

                <div class="color-picker">
                    <span style="font-weight: bold;">Couleur de votre point :</span>
                    <div class="color-option selected" style="background: #e74c3c;" onclick="selectColor('canvas3', '#e74c3c')"></div>
                    <div class="color-option" style="background: #3498db;" onclick="selectColor('canvas3', '#3498db')"></div>
                    <div class="color-option" style="background: #2ecc71;" onclick="selectColor('canvas3', '#2ecc71')"></div>
                    <div class="color-option" style="background: #f39c12;" onclick="selectColor('canvas3', '#f39c12')"></div>
                    <div class="color-option" style="background: #9b59b6;" onclick="selectColor('canvas3', '#9b59b6')"></div>
                    <div class="color-option" style="background: #1abc9c;" onclick="selectColor('canvas3', '#1abc9c')"></div>
                </div>

                <div class="controls-bottom">
                    <button class="btn btn-danger" onclick="clearMyPoint('canvas3')">üóëÔ∏è Effacer mon point</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QRCode.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // Configuration globale
        let currentSession = null;
        let currentUser = null;
        let isAnimator = false;
        let sessionData = {};
        let currentPage = 1;

        // Configuration pour chaque diagramme
        const diagramConfig = {
            canvas1: { color: '#e74c3c' },
            canvas2: { color: '#e74c3c' },
            canvas3: { color: '#e74c3c' }
        };

        // Initialiser les gestionnaires de clic pour chaque SVG
        ['1', '2', '3'].forEach(num => {
            const svgWrapper = document.getElementById('svgWrapper' + num);
            const svg = document.getElementById('svg' + num);
            const canvasId = 'canvas' + num;
            
            svgWrapper.addEventListener('click', function(e) {
                if (!currentSession) return;
                
                const rect = svg.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 1000;
                const y = ((e.clientY - rect.top) / rect.height) * 1000;
                
                addPoint(canvasId, x, y);
            });
        });

        function selectRole(role) {
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.role-btn').classList.add('selected');
            
            if (role === 'animator') {
                document.getElementById('animatorForm').classList.remove('hidden');
                document.getElementById('participantForm').classList.add('hidden');
            } else {
                document.getElementById('animatorForm').classList.add('hidden');
                document.getElementById('participantForm').classList.remove('hidden');
            }
        }

        function generateSessionCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function createSession() {
            const sessionCode = generateSessionCode();
            const sessionName = document.getElementById('sessionNameInput').value || 'Session sans nom';
            
            currentSession = sessionCode;
            currentUser = 'animator_' + Date.now();
            isAnimator = true;
            
            sessionData = {
                code: sessionCode,
                name: sessionName,
                created: Date.now(),
                participants: {},
                currentPage: 1,
                points: {
                    canvas1: [],
                    canvas2: [],
                    canvas3: []
                }
            };
            
            saveSessionData();
            showMainInterface();
            generateQRCode();
        }

        function joinSession() {
            const code = document.getElementById('sessionCodeInput').value.toUpperCase().trim();
            const pseudo = document.getElementById('pseudoInput').value || 'Participant';
            
            if (!code) {
                alert('‚ö†Ô∏è Veuillez entrer un code de session');
                return;
            }
            
            const storedSession = localStorage.getItem('session_' + code);
            if (!storedSession) {
                alert('‚ùå Session introuvable. V√©rifiez le code.');
                return;
            }
            
            currentSession = code;
            currentUser = 'user_' + Date.now();
            isAnimator = false;
            
            sessionData = JSON.parse(storedSession);
            
            sessionData.participants[currentUser] = {
                pseudo: pseudo,
                joined: Date.now()
            };
            
            saveSessionData();
            showMainInterface();
            startAutoRefresh();
        }

        function showMainInterface() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainInterface').classList.add('active');
            document.getElementById('displaySessionCode').textContent = currentSession;
            
            if (isAnimator) {
                document.getElementById('animatorPanel').classList.remove('hidden');
            }
            
            updateParticipantCount();
            changePage(sessionData.currentPage || 1);
            redrawAllDiagrams();
        }

        function leaveSession() {
            if (confirm('Voulez-vous vraiment quitter la session ?')) {
                if (isAnimator && confirm('‚ö†Ô∏è En tant qu\'animateur, quitter supprimera la session pour tous. Continuer ?')) {
                    localStorage.removeItem('session_' + currentSession);
                } else if (!isAnimator) {
                    delete sessionData.participants[currentUser];
                    saveSessionData();
                }
                
                location.reload();
            }
        }

        function changePage(pageNumber) {
            if (!isAnimator) return; // Seul l'animateur peut changer de page
            
            currentPage = pageNumber;
            sessionData.currentPage = pageNumber;
            saveSessionData();
            
            // Masquer tous les diagrammes
            document.querySelectorAll('.diagram-view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Afficher le diagramme s√©lectionn√©
            document.getElementById('diagram' + pageNumber).classList.add('active');
        }

        function addPoint(canvasId, x, y) {
            // Supprimer le point existant de l'utilisateur
            sessionData.points[canvasId] = sessionData.points[canvasId].filter(
                point => point.userId !== currentUser
            );
            
            const point = {
                x: x,
                y: y,
                color: diagramConfig[canvasId].color,
                userId: currentUser,
                timestamp: Date.now()
            };
            
            sessionData.points[canvasId].push(point);
            saveSessionData();
            redrawDiagram(canvasId);
        }

        function clearMyPoint(canvasId) {
            sessionData.points[canvasId] = sessionData.points[canvasId].filter(
                point => point.userId !== currentUser
            );
            saveSessionData();
            redrawDiagram(canvasId);
        }

        function clearAllPoints() {
            if (!isAnimator) return;
            
            if (confirm('Effacer tous les points de tous les participants ?')) {
                sessionData.points = {
                    canvas1: [],
                    canvas2: [],
                    canvas3: []
                };
                saveSessionData();
                redrawAllDiagrams();
            }
        }

        function redrawDiagram(canvasId) {
            const diagramNumber = canvasId.slice(-1);
            const pointsGroup = document.getElementById('pointsGroup' + diagramNumber);
            
            pointsGroup.innerHTML = '';
            
            if (sessionData.points && sessionData.points[canvasId]) {
                sessionData.points[canvasId].forEach((point) => {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', point.x);
                    circle.setAttribute('cy', point.y);
                    circle.setAttribute('r', '10');
                    circle.setAttribute('fill', point.color);
                    circle.setAttribute('stroke', '#fff');
                    circle.setAttribute('stroke-width', '2');
                    circle.setAttribute('class', 'point');
                    circle.setAttribute('data-user', point.userId);
                    pointsGroup.appendChild(circle);
                });
            }
        }

        function redrawAllDiagrams() {
            ['canvas1', 'canvas2', 'canvas3'].forEach(canvasId => {
                redrawDiagram(canvasId);
            });
        }

        function selectColor(canvasId, color) {
            diagramConfig[canvasId].color = color;
            
            const diagramNumber = canvasId.slice(-1);
            const diagram = document.getElementById('diagram' + diagramNumber);
            diagram.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function saveSessionData() {
            localStorage.setItem('session_' + currentSession, JSON.stringify(sessionData));
        }

        function loadSessionData() {
            const stored = localStorage.getItem('session_' + currentSession);
            if (stored) {
                const oldPage = currentPage;
                sessionData = JSON.parse(stored);
                
                // Les participants suivent automatiquement la page de l'animateur
                if (!isAnimator && sessionData.currentPage !== oldPage) {
                    currentPage = sessionData.currentPage;
                    document.querySelectorAll('.diagram-view').forEach(view => {
                        view.classList.remove('active');
                    });
                    document.getElementById('diagram' + currentPage).classList.add('active');
                }
                
                redrawAllDiagrams();
                updateParticipantCount();
            }
        }

        function updateParticipantCount() {
            const count = Object.keys(sessionData.participants || {}).length;
            const elem = document.getElementById('participantCount');
            if (elem) {
                elem.textContent = count;
            }
        }

        function startAutoRefresh() {
            setInterval(() => {
                loadSessionData();
            }, 2000);
        }

        function generateQRCode() {
            const url = window.location.href.split('?')[0] + '?session=' + currentSession;
            
            const qrcodeContainer = document.getElementById('qrcode');
            qrcodeContainer.innerHTML = '';
            
            new QRCode(qrcodeContainer, {
                text: url,
                width: 150,
                height: 150,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        function downloadResults() {
            if (!isAnimator) return;
            
            let results = `R√©sultats de la session: ${sessionData.name}\n`;
            results += `Code: ${currentSession}\n`;
            results += `Date: ${new Date(sessionData.created).toLocaleString('fr-FR')}\n`;
            results += `Participants: ${Object.keys(sessionData.participants).length}\n\n`;
            
            const questions = [
                'Difficult√©s au travail',
                'Envie de rester dans l\'entreprise',
                'Stress au travail'
            ];
            
            ['canvas1', 'canvas2', 'canvas3'].forEach((canvasId, index) => {
                results += `\n=== ${questions[index]} ===\n`;
                results += `Nombre de points: ${sessionData.points[canvasId].length}\n`;
                
                sessionData.points[canvasId].forEach((point, i) => {
                    const participant = sessionData.participants[point.userId];
                    const pseudo = participant ? participant.pseudo : 'Anonyme';
                    results += `Point ${i+1}: ${pseudo} - Position (${Math.round(point.x)}, ${Math.round(point.y)}) - Couleur: ${point.color}\n`;
                });
            });
            
            const blob = new Blob([results], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `resultats_session_${currentSession}.txt`;
            a.click();
        }

        // Auto-join si param√®tre session dans URL
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('session');
            
            if (sessionParam) {
                document.getElementById('sessionCodeInput').value = sessionParam;
            }
        });
    </script>
</body>
</html>
